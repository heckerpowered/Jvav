## 开发者文档

Mamba是Jvav编译器的名字。
.NET Linker是一个链接器，它将Mamba生成的二进制文件链接到MSIL并生成可执行二进制。（准确地说，Mamba生成的文件就已经是MSIL了，但它的格式只有专用链接器可解析，链接器生成可执行二进制文件）

### 代码结构

*所有源文件都应该放在src文件夹下*

src/Mamba - Mamba的源文件

src/.NET Linker - .NET链接器源文件

src/Test - Mamba的测试用例，其中，一个源文件对应一个测试

### Mamba

Mamba的编译过程分为如下几个部分
- 文件读取
- 词法分析（lexer）
- 语法分析（parser）
- 绑定（Binding）
- 生成（Emit）

#### 文件读取

这是Mamba的第一编译阶段，首先Mamba读取所有输入文件（通常是启动参数），并构造SourceText的集合。

SourceText表示一个源文件，它将文件名和文件内容联系在一起。

随后Mamba将源文件集合传递给Compilation，Compilation负责接下来的编译阶段。

#### 词法分析

这是Mamba的第二编译阶段，词法分析必须运行在语法分析之前，词法分析器（lexer）将源文件的内容解析为Token的集合，
随后语法分析器将以Token的单位进行分析。

例如，数字应该是一个token，比如114514是一个NumberToken，其值是对应的数字。+是一个PlusToken。

词法分析器将114514 + 1919810分析为3个Token，分别是NumberToken, PlusToken, NumberToken

随后语法分析器将token组成有意义的语法，例如这三个token应该能组成一个二元表达式。

#### 语法分析

这是Mamba的第三编译阶段，语法分析器将词法解析为有意义的表达式或语句。
在此阶段，任何语法都是Token的集合。

例如，NumberToken会被解析为字面量表达式，随后上述的三个Token会被按顺序组合成二元表达式。

#### 绑定
绑定是Mamba的第四编译阶段，绑定将语法和更深层次的概念联系在一起，例如作用域。

绑定阶段引入了符号的概念，符号是一个有名字的变量/类型/函数。

变量符号将变量的类型及名字联系在一起。

函数符号将函数的名字，返回类型，参数和函数体。

参数也是变量。

编译器可通过函数符号查询函数的实现，符号由作用域持有，编译器可通过名字查找符号（名字查找）。

#### 生成

生成是Mamba的第五编译阶段，在绑定之后，生成器将绑定语法编译到中间语言或是本机可执行文件。

如果目标平台在Mamba中难以编译，则可以引入链接阶段。

Mamba将生成一种由Mamba约定的中间语言，随后链接器讲读取它，并生成可执行二进制。

例如，在Java运行时上生成jar会比在Mamba中生成方便的多，因此需要引入链接器。

一般地，一个二元表达式114514 + 1919810将编译为以下形式：

##### MSIL

```
ldci4 114514
ldci4 1919810
add
```

##### Java Bytecode

```
ldc 114514
ldc 1919810
iadd
```

##### ARM64 (AArch64)

```
add x0, x0, x1
```

如上所示，无论是哪种指令集，它们都将表达式计算结果推送到栈上。
如果表达式是一个表达式语句，此处应该将表达式结果从栈上弹出。
如果表达式语句没有可观察的副作用，那么可以考虑优化掉。
